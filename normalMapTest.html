<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Normal Mapping</title>
    <style>
        html, body {
            background-color: black;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
<script src="js/three.js"></script>
<script src="js/OrbitControls.js"></script>
<script>
    var scene, camera, renderer, controls, mouseDown;
    var light, orbit, moon;
    init();
    render();
    function init() {
        scene = new THREE.Scene();
        var path = "img/EnvMap/";
        var format = ".jpg";
        var envMap = new THREE.CubeTextureLoader().load([
            path + 'px' + format, path + 'nx' + format,
            path + 'py' + format, path + 'ny' + format,
            path + 'pz' + format, path + 'nz' + format
        ]);
        scene.background = envMap;
        renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        window.addEventListener('resize', function() {
            var width = window.innerWidth;
            var height = window.innerHeight;
            renderer.setSize(width, height);
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.render(scene, camera);
        });
        var aspect = window.innerWidth / window.innerHeight;
        camera = new THREE.PerspectiveCamera(75, aspect, 0.1, 5000);
        camera.position.set(0, 10, 120);
        controls = new THREE.OrbitControls(camera, renderer.domElement);
        light = new THREE.HemisphereLight('rgb(0, 153, 255)', 'rgb(133, 224, 224)', 0.15);
        scene.add(light);
        light = new THREE.SpotLight();
        light.position.z = 100;
        light.castShadow = true;
        orbit = new THREE.Scene();
        orbit.add(light);
        scene.add(orbit);
        var textureLoader = new THREE.TextureLoader();
        var geo = new THREE.SphereGeometry(60, 24, 16);
        var mat = new THREE.MeshPhongMaterial({
            map: textureLoader.load("img/moon_surface.jpg"),
            normalMap: textureLoader.load("img/moon_normal.jpg"),
            displacementMap: textureLoader.load("img/moon_displacement.jpg"),
            displacementScale: 3
        });
        moon = new THREE.Mesh(geo, mat);
        moon.castShadow = true;
        moon.receiveShadow = true;
        scene.add(moon);
        window.onmousedown = function() {
            mouseDown = true;
            if(event.button === 2) {
                controls.reset();
            }
        };
        window.onmouseup = function() {mouseDown = false;};

    }
    function render() {
        requestAnimationFrame(render);
        renderer.render(scene, camera);
        if(!mouseDown) {
            moon.rotation.y += 0.001;
            orbit.rotation.y += 0.01;
        }
    }
</script>
</body>
</html>