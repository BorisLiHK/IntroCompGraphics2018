<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Normal Mapping</title>
    <style>
        html, body {
            background-color: black;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
    <script src="js/three.js"></script>
    <script src="js/OrbitControls.js"></script>
    <!--<script src="js/dat.gui.min.js"></script>-->
    <script>
        var scene, camera, renderer, controls;
        var light, orbit, moon;
        init();
        render();
        function init() {
            scene = new THREE.Scene();
            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);
            window.addEventListener('resize', function() {
                var width = window.innerWidth;
                var height = window.innerHeight;
                renderer.setSize(width, height);
                camera.aspect = width / height;
                camera.updateProjectionMatrix();
                renderer.render(scene, camera);
            });
            var aspect = window.innerWidth / window.innerHeight;
            camera = new THREE.PerspectiveCamera(75, aspect, 0.1, 5000);
            camera.position.set(0, 10, 120);
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            light = new THREE.AmbientLight(0xffffff, 0.2);
            scene.add(light);
            light = new THREE.SpotLight();
            light.position.z = 100;
            orbit = new THREE.Scene();
            orbit.add(light);
            scene.add(orbit);
            var textureLoader = new THREE.TextureLoader();
            var geo = new THREE.SphereGeometry(60, 24, 16);
            var moonSurface = textureLoader.load("img/moon_displacement.jpg");
            var mat = new THREE.MeshPhongMaterial({
                normalMap: textureLoader.load("img/moon_normal.jpg"),
                map: moonSurface,
                displacementMap: moonSurface,
                displacementScale: 2
            });
            moon = new THREE.Mesh(geo, mat);
            scene.add(moon);
            window.onmousedown = function() {
                if(event.button === 2) {
                    controls.reset();
                }
            };

        }
        function render() {
            requestAnimationFrame(render);
            renderer.render(scene, camera);
            moon.rotation.y += 0.001;
            orbit.rotation.y += 0.01;
        }
    </script>
</body>
</html>